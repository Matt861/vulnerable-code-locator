[
  {
    "source_url": "https://github.com/qos-ch/logback/commit/9c782b45be4abdafb7e17481e24e7354c2acd1eb.patch",
    "commit_sha": "9c782b45be4abdafb7e17481e24e7354c2acd1eb",
    "repo": "qos-ch/logback",
    "title": "Referenced by https://security.snyk.io/vuln/SNYK-JAVA-CHQOSLOGBACK-6094943",
    "file_diffs": [
      {
        "path": "logback-classic/src/main/java/ch/qos/logback/classic/spi/LoggingEventVO.java",
        "hunks": [
          {
            "old_start": 14,
            "old_len": 6,
            "new_start": 14,
            "new_len": 7,
            "context": "",
            "symbol_guess": null,
            "removed": [],
            "added": [
              "import java.io.InvalidObjectException;"
            ],
            "near_context": [
              "package ch.qos.logback.classic.spi;",
              "",
              "import java.io.IOException;",
              "import java.io.ObjectInputStream;",
              "import java.io.ObjectOutputStream;",
              "import java.io.Serializable;"
            ]
          },
          {
            "old_start": 28,
            "old_len": 6,
            "new_start": 29,
            "new_len": 7,
            "context": "",
            "symbol_guess": null,
            "removed": [],
            "added": [
              "// See also the paper https://www.riehle.org/computer-science/research/1998/ubilab-tr-1998-10-1.pdf"
            ],
            "near_context": [
              "package ch.qos.logback.classic.spi;",
              "import java.io.IOException;",
              "import java.io.ObjectInputStream;",
              "import java.io.ObjectOutputStream;",
              "import java.io.Serializable;",
              "import ch.qos.logback.classic.Level;",
              "",
              "// http://www.riehle.org/computer-science/research/1998/ubilab-tr-1998-10-1.html",
              "",
              "/**",
              " * A read-only and serializable implementation of {@link ILoggingEvent}."
            ]
          },
          {
            "old_start": 41,
            "old_len": 6,
            "new_start": 43,
            "new_len": 7,
            "context": "public class LoggingEventVO implements ILoggingEvent, Serializable {",
            "symbol_guess": null,
            "removed": [],
            "added": [
              "    private static final int ARGUMENT_ARRAY_DESERIALIZATION_LIMIT = 128;"
            ],
            "near_context": [
              "import java.io.IOException;",
              "import java.io.ObjectInputStream;",
              "import java.io.ObjectOutputStream;",
              "import java.io.Serializable;",
              "import ch.qos.logback.classic.Level;",
              "// http://www.riehle.org/computer-science/research/1998/ubilab-tr-1998-10-1.html",
              "/**",
              "* A read-only and serializable implementation of {@link ILoggingEvent}.",
              "",
              "    private static final int NULL_ARGUMENT_ARRAY = -1;",
              "    private static final String NULL_ARGUMENT_ARRAY_ELEMENT = \"NULL_ARGUMENT_ARRAY_ELEMENT\";",
              "",
              "    private String threadName;",
              "    private String loggerName;"
            ]
          },
          {
            "old_start": 203,
            "old_len": 6,
            "new_start": 206,
            "new_len": 12,
            "context": "private void readObject(ObjectInputStream in) throws IOException, ClassNotFoundE",
            "symbol_guess": "readObject",
            "removed": [],
            "added": [
              "",
              "        // Prevent DOS attacks via large or negative arrays",
              "        if (argArrayLen < 0 || argArrayLen > ARGUMENT_ARRAY_DESERIALIZATION_LIMIT) {",
              "            throw new InvalidObjectException(\"Argument array length is invalid: \" + argArrayLen);",
              "        }",
              ""
            ],
            "near_context": [
              "import ch.qos.logback.classic.Level;",
              "// http://www.riehle.org/computer-science/research/1998/ubilab-tr-1998-10-1.html",
              "/**",
              "* A read-only and serializable implementation of {@link ILoggingEvent}.",
              "private static final int NULL_ARGUMENT_ARRAY = -1;",
              "private static final String NULL_ARGUMENT_ARRAY_ELEMENT = \"NULL_ARGUMENT_ARRAY_ELEMENT\";",
              "private String threadName;",
              "private String loggerName;",
              "        level = Level.toLevel(levelInt);",
              "",
              "        int argArrayLen = in.readInt();",
              "        if (argArrayLen != NULL_ARGUMENT_ARRAY) {",
              "            argumentArray = new String[argArrayLen];",
              "            for (int i = 0; i < argArrayLen; i++) {"
            ]
          }
        ]
      },
      {
        "path": "logback-core/src/main/java/ch/qos/logback/core/net/HardenedObjectInputStream.java",
        "hunks": [
          {
            "old_start": 16,
            "old_len": 6,
            "new_start": 16,
            "new_len": 7,
            "context": "",
            "symbol_guess": null,
            "removed": [],
            "added": [
              "import java.io.ObjectInputFilter;"
            ],
            "near_context": [
              "import java.io.IOException;",
              "import java.io.InputStream;",
              "import java.io.InvalidClassException;",
              "import java.io.ObjectInputStream;",
              "import java.io.ObjectStreamClass;",
              "import java.util.ArrayList;"
            ]
          },
          {
            "old_start": 36,
            "old_len": 20,
            "new_start": 37,
            "new_len": 27,
            "context": "",
            "symbol_guess": "super",
            "removed": [
              "    final List<String> whitelistedClassNames;",
              "    final static String[] JAVA_PACKAGES = new String[] { \"java.lang\", \"java.util\" };",
              "    public HardenedObjectInputStream(InputStream in, String[] whilelist) throws IOException {",
              "",
              "        if (whilelist != null) {",
              "            for (int i = 0; i < whilelist.length; i++) {",
              "                this.whitelistedClassNames.add(whilelist[i]);"
            ],
            "added": [
              "    final private List<String> whitelistedClassNames;",
              "    final private static String[] JAVA_PACKAGES = new String[] { \"java.lang\", \"java.util\" };",
              "    final private static int DEPTH_LIMIT = 16;",
              "    final private static int ARRAY_LIMIT = 10000;",
              "    public HardenedObjectInputStream(InputStream in, String[] whitelist) throws IOException {",
              "        this.initObjectFilter();",
              "        if (whitelist != null) {",
              "            for (int i = 0; i < whitelist.length; i++) {",
              "                this.whitelistedClassNames.add(whitelist[i]);",
              "    private void initObjectFilter() {",
              "        this.setObjectInputFilter(ObjectInputFilter.Config.createFilter(",
              "                \"maxarray=\" + ARRAY_LIMIT + \";maxdepth=\" + DEPTH_LIMIT + \";\"",
              "        ));",
              "    }"
            ],
            "near_context": [
              "import java.io.IOException;",
              "import java.io.InputStream;",
              "import java.io.InvalidClassException;",
              "import java.io.ObjectInputStream;",
              "import java.io.ObjectStreamClass;",
              "import java.util.ArrayList;",
              " */",
              "public class HardenedObjectInputStream extends ObjectInputStream {",
              "",
              "",
              "        super(in);",
              "        this.whitelistedClassNames = new ArrayList<String>();",
              "            }",
              "        }",
              "    }",
              "",
              "    public HardenedObjectInputStream(InputStream in, List<String> whitelist) throws IOException {",
              "        super(in);",
              ""
            ]
          }
        ]
      }
    ]
  },
  {
    "source_url": "https://github.com/qos-ch/logback/commit/b8eac23a9de9e05fb6d51160b3f46acd91af9731.patch",
    "commit_sha": "b8eac23a9de9e05fb6d51160b3f46acd91af9731",
    "repo": "qos-ch/logback",
    "title": "Referenced by https://security.snyk.io/vuln/SNYK-JAVA-CHQOSLOGBACK-6094943",
    "file_diffs": [
      {
        "path": "logback-classic/src/main/java/ch/qos/logback/classic/spi/LoggingEventVO.java",
        "hunks": [
          {
            "old_start": 14,
            "old_len": 6,
            "new_start": 14,
            "new_len": 7,
            "context": "",
            "symbol_guess": null,
            "removed": [],
            "added": [
              "import java.io.InvalidObjectException;"
            ],
            "near_context": [
              "package ch.qos.logback.classic.spi;",
              "",
              "import java.io.IOException;",
              "import java.io.ObjectInputStream;",
              "import java.io.ObjectOutputStream;",
              "import java.io.Serializable;"
            ]
          },
          {
            "old_start": 28,
            "old_len": 6,
            "new_start": 29,
            "new_len": 7,
            "context": "",
            "symbol_guess": null,
            "removed": [],
            "added": [
              "// See also the paper https://www.riehle.org/computer-science/research/1998/ubilab-tr-1998-10-1.pdf"
            ],
            "near_context": [
              "package ch.qos.logback.classic.spi;",
              "import java.io.IOException;",
              "import java.io.ObjectInputStream;",
              "import java.io.ObjectOutputStream;",
              "import java.io.Serializable;",
              "import ch.qos.logback.classic.Level;",
              "",
              "// http://www.riehle.org/computer-science/research/1998/ubilab-tr-1998-10-1.html",
              "",
              "/**",
              " * A read-only and serializable implementation of {@link ILoggingEvent}."
            ]
          },
          {
            "old_start": 41,
            "old_len": 6,
            "new_start": 43,
            "new_len": 7,
            "context": "public class LoggingEventVO implements ILoggingEvent, Serializable {",
            "symbol_guess": null,
            "removed": [],
            "added": [
              "    private static final int ARGUMENT_ARRAY_DESERIALIZATION_LIMIT = 128;"
            ],
            "near_context": [
              "import java.io.IOException;",
              "import java.io.ObjectInputStream;",
              "import java.io.ObjectOutputStream;",
              "import java.io.Serializable;",
              "import ch.qos.logback.classic.Level;",
              "// http://www.riehle.org/computer-science/research/1998/ubilab-tr-1998-10-1.html",
              "/**",
              "* A read-only and serializable implementation of {@link ILoggingEvent}.",
              "",
              "    private static final int NULL_ARGUMENT_ARRAY = -1;",
              "    private static final String NULL_ARGUMENT_ARRAY_ELEMENT = \"NULL_ARGUMENT_ARRAY_ELEMENT\";",
              "",
              "    private String threadName;",
              "    private String loggerName;"
            ]
          },
          {
            "old_start": 203,
            "old_len": 6,
            "new_start": 206,
            "new_len": 12,
            "context": "private void readObject(ObjectInputStream in) throws IOException, ClassNotFoundE",
            "symbol_guess": "readObject",
            "removed": [],
            "added": [
              "",
              "        // Prevent DOS attacks via large or negative arrays",
              "        if (argArrayLen < 0 || argArrayLen > ARGUMENT_ARRAY_DESERIALIZATION_LIMIT) {",
              "            throw new InvalidObjectException(\"Argument array length is invalid: \" + argArrayLen);",
              "        }",
              ""
            ],
            "near_context": [
              "import ch.qos.logback.classic.Level;",
              "// http://www.riehle.org/computer-science/research/1998/ubilab-tr-1998-10-1.html",
              "/**",
              "* A read-only and serializable implementation of {@link ILoggingEvent}.",
              "private static final int NULL_ARGUMENT_ARRAY = -1;",
              "private static final String NULL_ARGUMENT_ARRAY_ELEMENT = \"NULL_ARGUMENT_ARRAY_ELEMENT\";",
              "private String threadName;",
              "private String loggerName;",
              "        level = Level.toLevel(levelInt);",
              "",
              "        int argArrayLen = in.readInt();",
              "        if (argArrayLen != NULL_ARGUMENT_ARRAY) {",
              "            argumentArray = new String[argArrayLen];",
              "            for (int i = 0; i < argArrayLen; i++) {"
            ]
          }
        ]
      },
      {
        "path": "logback-core/src/main/java/ch/qos/logback/core/net/HardenedObjectInputStream.java",
        "hunks": [
          {
            "old_start": 16,
            "old_len": 6,
            "new_start": 16,
            "new_len": 7,
            "context": "",
            "symbol_guess": null,
            "removed": [],
            "added": [
              "import java.io.ObjectInputFilter;"
            ],
            "near_context": [
              "import java.io.IOException;",
              "import java.io.InputStream;",
              "import java.io.InvalidClassException;",
              "import java.io.ObjectInputStream;",
              "import java.io.ObjectStreamClass;",
              "import java.util.ArrayList;"
            ]
          },
          {
            "old_start": 36,
            "old_len": 20,
            "new_start": 37,
            "new_len": 27,
            "context": "",
            "symbol_guess": "super",
            "removed": [
              "    final List<String> whitelistedClassNames;",
              "    final static String[] JAVA_PACKAGES = new String[] { \"java.lang\", \"java.util\" };",
              "    public HardenedObjectInputStream(InputStream in, String[] whilelist) throws IOException {",
              "",
              "        if (whilelist != null) {",
              "            for (int i = 0; i < whilelist.length; i++) {",
              "                this.whitelistedClassNames.add(whilelist[i]);"
            ],
            "added": [
              "    final private List<String> whitelistedClassNames;",
              "    final private static String[] JAVA_PACKAGES = new String[] { \"java.lang\", \"java.util\" };",
              "    final private static int DEPTH_LIMIT = 16;",
              "    final private static int ARRAY_LIMIT = 10000;",
              "    public HardenedObjectInputStream(InputStream in, String[] whitelist) throws IOException {",
              "        this.initObjectFilter();",
              "        if (whitelist != null) {",
              "            for (int i = 0; i < whitelist.length; i++) {",
              "                this.whitelistedClassNames.add(whitelist[i]);",
              "    private void initObjectFilter() {",
              "        this.setObjectInputFilter(ObjectInputFilter.Config.createFilter(",
              "                \"maxarray=\" + ARRAY_LIMIT + \";maxdepth=\" + DEPTH_LIMIT + \";\"",
              "        ));",
              "    }"
            ],
            "near_context": [
              "import java.io.IOException;",
              "import java.io.InputStream;",
              "import java.io.InvalidClassException;",
              "import java.io.ObjectInputStream;",
              "import java.io.ObjectStreamClass;",
              "import java.util.ArrayList;",
              " */",
              "public class HardenedObjectInputStream extends ObjectInputStream {",
              "",
              "",
              "        super(in);",
              "        this.whitelistedClassNames = new ArrayList<String>();",
              "            }",
              "        }",
              "    }",
              "",
              "    public HardenedObjectInputStream(InputStream in, List<String> whitelist) throws IOException {",
              "        super(in);",
              ""
            ]
          }
        ]
      }
    ]
  },
  {
    "source_url": "https://github.com/qos-ch/logback/commit/bb095154be011267b64e37a1d401546e7cc2b7c3.patch",
    "commit_sha": "bb095154be011267b64e37a1d401546e7cc2b7c3",
    "repo": "qos-ch/logback",
    "title": "Referenced by https://security.snyk.io/vuln/SNYK-JAVA-CHQOSLOGBACK-6094943",
    "file_diffs": [
      {
        "path": "logback-classic/src/main/java/ch/qos/logback/classic/spi/LoggingEventVO.java",
        "hunks": [
          {
            "old_start": 14,
            "old_len": 6,
            "new_start": 14,
            "new_len": 7,
            "context": "",
            "symbol_guess": null,
            "removed": [],
            "added": [
              "import java.io.InvalidObjectException;"
            ],
            "near_context": [
              "package ch.qos.logback.classic.spi;",
              "",
              "import java.io.IOException;",
              "import java.io.ObjectInputStream;",
              "import java.io.ObjectOutputStream;",
              "import java.io.Serializable;"
            ]
          },
          {
            "old_start": 38,
            "old_len": 6,
            "new_start": 39,
            "new_len": 7,
            "context": "public class LoggingEventVO implements ILoggingEvent, Serializable {",
            "symbol_guess": null,
            "removed": [],
            "added": [
              "    private static final int ARGUMENT_ARRAY_DESERIALIZATION_LIMIT = 128;"
            ],
            "near_context": [
              "package ch.qos.logback.classic.spi;",
              "import java.io.IOException;",
              "import java.io.ObjectInputStream;",
              "import java.io.ObjectOutputStream;",
              "import java.io.Serializable;",
              "",
              "    private static final int NULL_ARGUMENT_ARRAY = -1;",
              "    private static final String NULL_ARGUMENT_ARRAY_ELEMENT = \"NULL_ARGUMENT_ARRAY_ELEMENT\";",
              "",
              "    private String threadName;",
              "    private String loggerName;"
            ]
          },
          {
            "old_start": 181,
            "old_len": 6,
            "new_start": 183,
            "new_len": 11,
            "context": "private void readObject(ObjectInputStream in) throws IOException, ClassNotFoundE",
            "symbol_guess": "readObject",
            "removed": [],
            "added": [
              "        // Prevent DOS attacks via large or negative arrays",
              "        if (argArrayLen < NULL_ARGUMENT_ARRAY || argArrayLen > ARGUMENT_ARRAY_DESERIALIZATION_LIMIT) {",
              "            throw new InvalidObjectException(\"Argument array length is invalid: \" + argArrayLen);",
              "        }",
              ""
            ],
            "near_context": [
              "import java.io.IOException;",
              "import java.io.ObjectInputStream;",
              "import java.io.ObjectOutputStream;",
              "import java.io.Serializable;",
              "private static final int NULL_ARGUMENT_ARRAY = -1;",
              "private static final String NULL_ARGUMENT_ARRAY_ELEMENT = \"NULL_ARGUMENT_ARRAY_ELEMENT\";",
              "private String threadName;",
              "private String loggerName;",
              "        level = Level.toLevel(levelInt);",
              "",
              "        int argArrayLen = in.readInt();",
              "        if (argArrayLen != NULL_ARGUMENT_ARRAY) {",
              "            argumentArray = new String[argArrayLen];",
              "            for (int i = 0; i < argArrayLen; i++) {"
            ]
          }
        ]
      },
      {
        "path": "logback-classic/src/test/input/issue/logback-1754.xml",
        "hunks": [
          {
            "old_start": 0,
            "old_len": 0,
            "new_start": 1,
            "new_len": 30,
            "context": "",
            "symbol_guess": "Copyright",
            "removed": [],
            "added": [
              "<?xml version=\"1.0\" encoding=\"UTF-8\"?>",
              "<!--",
              "  ~ Logback: the reliable, generic, fast and flexible logging framework.",
              "  ~ Copyright (C) 1999-2023, QOS.ch. All rights reserved.",
              "  ~",
              "  ~ This program and the accompanying materials are dual-licensed under",
              "  ~ either the terms of the Eclipse Public License v1.0 as published by",
              "  ~ the Eclipse Foundation",
              "  ~",
              "  ~   or (per the licensee's choosing)",
              "  ~",
              "  ~ under the terms of the GNU Lesser General Public License version 2.1",
              "  ~ as published by the Free Software Foundation.",
              "  -->",
              "",
              "<configuration debug=\"true\">",
              "    <appender name=\"GENERAL\" class=\"ch.qos.logback.core.rolling.RollingFileAppender\">",
              "        <rollingPolicy class=\"ch.qos.logback.core.rolling.TimeBasedRollingPolicy\">",
              "            <fileNamePattern>${logback_1754_targetDirectory}/test-%d{yyyy-MM-dd}.log</fileNamePattern>",
              "            <maxHistory>120</maxHistory>",
              "        </rollingPolicy>",
              "        <encoder>",
              "            <pattern>%date{HH:mm:ss.SSS} [%level] %logger{0} [%thread] [%class{3}:%line] : %msg%n</pattern>",
              "        </encoder>",
              "        <prudent>true</prudent>",
              "    </appender>",
              "    <root level=\"debug\">",
              "        <appender-ref ref=\"GENERAL\" />",
              "    </root>",
              "</configuration>"
            ],
            "near_context": [
              "new file mode 100644"
            ]
          }
        ]
      },
      {
        "path": "logback-classic/src/test/java/ch/qos/logback/classic/issue/logback_1754/LogbackTest.java",
        "hunks": [
          {
            "old_start": 0,
            "old_len": 0,
            "new_start": 1,
            "new_len": 78,
            "context": "",
            "symbol_guess": "Copyright",
            "removed": [],
            "added": [
              "/*",
              " * Logback: the reliable, generic, fast and flexible logging framework.",
              " * Copyright (C) 1999-2023, QOS.ch. All rights reserved.",
              " *",
              " * This program and the accompanying materials are dual-licensed under",
              " * either the terms of the Eclipse Public License v1.0 as published by",
              " * the Eclipse Foundation",
              " *",
              " *   or (per the licensee's choosing)",
              " *",
              " * under the terms of the GNU Lesser General Public License version 2.1",
              " * as published by the Free Software Foundation.",
              " */",
              "",
              "package ch.qos.logback.classic.issue.logback_1754;",
              "",
              "import ch.qos.logback.classic.ClassicConstants;",
              "import ch.qos.logback.classic.ClassicTestConstants;",
              "import ch.qos.logback.core.testUtil.RandomUtil;",
              "import org.slf4j.Logger;",
              "import org.slf4j.LoggerFactory;",
              "",
              "import java.util.ArrayList;",
              "import java.util.List;",
              "import java.util.concurrent.CountDownLatch;",
              "",
              "import static ch.qos.logback.classic.util.ContextInitializer.CONFIG_FILE_PROPERTY;",
              "",
              "public class LogbackTest {",
              "",
              "    private static final int THREADS = 16;",
              "",
              "    private void runTest() {",
              "",
              "        int diff = RandomUtil.getPositiveInt();",
              "        //System.setProperty(\"logback.statusListenerClass\", \"sysout\");",
              "        System.setProperty(CONFIG_FILE_PROPERTY, ClassicTestConstants.INPUT_PREFIX+\"issue/logback-1754.xml\");",
              "        System.setProperty(\"logback_1754_targetDirectory\", ClassicTestConstants.OUTPUT_DIR_PREFIX+\"safeWrite_\"+diff);",
              "",
              "        CountDownLatch latch = new CountDownLatch(THREADS);",
              "        List<Thread> threads = new ArrayList<Thread>(THREADS);",
              "        for (int i = 0; i < THREADS; i++) {",
              "            LoggerThread thread = new LoggerThread(latch, \"message from thread \" + i);",
              "            thread.start();",
              "            threads.add(thread);",
              "        }",
              "        for (Thread thread : threads) {",
              "            try {",
              "                thread.join();",
              "            } catch (InterruptedException e) {",
              "                Thread.currentThread().interrupt();",
              "                throw new RuntimeException(e);",
              "            }",
              "        }",
              "    }",
              "",
              "    public static void main(String... args) {",
              "        new LogbackTest().runTest();",
              "    }",
              "",
              "    private static final class LoggerThread extends Thread {",
              "        private static final Logger LOG = LoggerFactory.getLogger(LoggerThread.class);",
              "        private final CountDownLatch latch;",
              "        private final String message;",
              "",
              "        LoggerThread(CountDownLatch latch, String message) {",
              "            setDaemon(false);",
              "            this.latch = latch;",
              "            this.message = message;",
              "        }",
              "",
              "        @Override",
              "        public void run() {",
              "            latch.countDown();",
              "            LOG.info(message);",
              "        }",
              "    }",
              "}"
            ],
            "near_context": [
              "new file mode 100644"
            ]
          }
        ]
      },
      {
        "path": "logback-core/src/main/java/ch/qos/logback/core/net/HardenedObjectInputStream.java",
        "hunks": [
          {
            "old_start": 1,
            "old_len": 10,
            "new_start": 1,
            "new_len": 27,
            "context": "",
            "symbol_guess": "Copyright",
            "removed": [],
            "added": [
              "/**",
              " * Logback: the reliable, generic, fast and flexible logging framework.",
              " * Copyright (C) 1999-2023, QOS.ch. All rights reserved.",
              " *",
              " * This program and the accompanying materials are dual-licensed under",
              " * either the terms of the Eclipse Public License v1.0 as published by",
              " * the Eclipse Foundation",
              " *",
              " *   or (per the licensee's choosing)",
              " *",
              " * under the terms of the GNU Lesser General Public License version 2.1",
              " * as published by the Free Software Foundation.",
              " */",
              "import ch.qos.logback.core.util.EnvUtil;",
              "",
              "import java.lang.reflect.InvocationTargetException;",
              "import java.lang.reflect.Method;"
            ],
            "near_context": [
              "package ch.qos.logback.core.net;",
              "",
              "import java.io.IOException;",
              "import java.io.InputStream;",
              "import java.io.InvalidClassException;",
              "import java.io.ObjectInputStream;",
              "import java.io.ObjectStreamClass;",
              "import java.util.ArrayList;",
              "import java.util.List;",
              ""
            ]
          },
          {
            "old_start": 22,
            "old_len": 10,
            "new_start": 39,
            "new_len": 12,
            "context": "public class HardenedObjectInputStream extends ObjectInputStream {",
            "symbol_guess": "HardenedObjectInputStream",
            "removed": [
              ""
            ],
            "added": [
              "    final private static int DEPTH_LIMIT = 16;",
              "    final private static int ARRAY_LIMIT = 10000;",
              "        initObjectFilter();"
            ],
            "near_context": [
              "package ch.qos.logback.core.net;",
              "import java.io.IOException;",
              "import java.io.InputStream;",
              "import java.io.InvalidClassException;",
              "import java.io.ObjectInputStream;",
              "import java.io.ObjectStreamClass;",
              "import java.util.ArrayList;",
              "import java.util.List;",
              "",
              "    final List<String> whitelistedClassNames;",
              "    final static String[] JAVA_PACKAGES = new String[] { \"java.lang\", \"java.util\" };",
              "",
              "    public HardenedObjectInputStream(InputStream in, String[] whilelist) throws IOException {",
              "        super(in);",
              "        this.whitelistedClassNames = new ArrayList<String>();",
              "        if (whilelist != null) {",
              "            for (int i = 0; i < whilelist.length; i++) {"
            ]
          },
          {
            "old_start": 36,
            "old_len": 11,
            "new_start": 55,
            "new_len": 43,
            "context": "public HardenedObjectInputStream(InputStream in, String[] whilelist) throws IOEx",
            "symbol_guess": "HardenedObjectInputStream",
            "removed": [
              ""
            ],
            "added": [
              "        initObjectFilter();",
              "    private void initObjectFilter() {",
              "",
              "        // invoke the following code by reflection",
              "        //  this.setObjectInputFilter(ObjectInputFilter.Config.createFilter(",
              "        //                \"maxarray=\" + ARRAY_LIMIT + \";maxdepth=\" + DEPTH_LIMIT + \";\"",
              "        //        ));",
              "        if(EnvUtil.isJDK9OrHigher()) {",
              "            try {",
              "                ClassLoader classLoader = this.getClass().getClassLoader();",
              "",
              "                Class oifClass = classLoader.loadClass(\"java.io.ObjectInputFilter\");",
              "                Class oifConfigClass = classLoader.loadClass(\"java.io.ObjectInputFilter$Config\");",
              "                Method setObjectInputFilterMethod = this.getClass().getMethod(\"setObjectInputFilter\", oifClass);",
              "",
              "                Method createFilterMethod = oifConfigClass.getMethod(\"createFilter\", String.class);",
              "                Object filter = createFilterMethod.invoke(null, \"maxarray=\" + ARRAY_LIMIT + \";maxdepth=\" + DEPTH_LIMIT + \";\");",
              "                setObjectInputFilterMethod.invoke(this, filter);",
              "            } catch (ClassNotFoundException e) {",
              "                // this code should be unreachable",
              "                throw new RuntimeException(\"Failed to initialize object filter\", e);",
              "            } catch (InvocationTargetException e) {",
              "                // this code should be unreachable",
              "                throw new RuntimeException(\"Failed to initialize object filter\", e);",
              "            } catch (NoSuchMethodException e) {",
              "                // this code should be unreachable",
              "                throw new RuntimeException(\"Failed to initialize object filter\", e);",
              "            } catch (IllegalAccessException e) {",
              "                // this code should be unreachable",
              "                throw new RuntimeException(\"Failed to initialize object filter\", e);",
              "            }",
              "        }",
              "    }"
            ],
            "near_context": [
              "import java.util.List;",
              "final List<String> whitelistedClassNames;",
              "final static String[] JAVA_PACKAGES = new String[] { \"java.lang\", \"java.util\" };",
              "public HardenedObjectInputStream(InputStream in, String[] whilelist) throws IOException {",
              "super(in);",
              "this.whitelistedClassNames = new ArrayList<String>();",
              "if (whilelist != null) {",
              "for (int i = 0; i < whilelist.length; i++) {",
              "",
              "    public HardenedObjectInputStream(InputStream in, List<String> whitelist) throws IOException {",
              "        super(in);",
              "        this.whitelistedClassNames = new ArrayList<String>();",
              "        this.whitelistedClassNames.addAll(whitelist);",
              "    }",
              "",
              "    @Override",
              "    protected Class<?> resolveClass(ObjectStreamClass anObjectStreamClass) throws IOException, ClassNotFoundException {",
              "        "
            ]
          }
        ]
      },
      {
        "path": "logback-core/src/main/java/ch/qos/logback/core/util/EnvUtil.java",
        "hunks": [
          {
            "old_start": 1,
            "old_len": 6,
            "new_start": 1,
            "new_len": 6,
            "context": "",
            "symbol_guess": "Copyright",
            "removed": [
              " * Copyright (C) 1999-2015, QOS.ch. All rights reserved."
            ],
            "added": [
              " * Copyright (C) 1999-2023, QOS.ch. All rights reserved."
            ],
            "near_context": [
              "/**",
              " * Logback: the reliable, generic, fast and flexible logging framework.",
              " *",
              " * This program and the accompanying materials are dual-licensed under",
              " * either the terms of the Eclipse Public License v1.0 as published by"
            ]
          },
          {
            "old_start": 22,
            "old_len": 22,
            "new_start": 22,
            "new_len": 27,
            "context": "",
            "symbol_guess": "isJDK_N_OrHigher",
            "removed": [
              "        List<String> versionList = new ArrayList<String>();",
              "        // this code should work at least until JDK 10 (assuming n parameter is",
              "        // always 6 or more)",
              "        for (int i = 0; i < 5; i++) {",
              "            versionList.add(\"1.\" + (n + i));",
              "        }",
              "",
              "        String javaVersion = System.getProperty(\"java.version\");",
              "        if (javaVersion == null) {",
              "        for (String v : versionList) {",
              "            if (javaVersion.startsWith(v))",
              "                return true;",
              "        }",
              "        return false;"
            ],
            "added": [
              "        String javaVersionStr = System.getProperty(\"java.version\", \"\");",
              "        if (javaVersionStr.isEmpty())",
              "",
              "        int version = getJDKVersion(javaVersionStr);",
              "        return version > 0 && n <= version;",
              "    }",
              "",
              "    static public int getJDKVersion(String javaVersionStr) {",
              "        int version = 0;",
              "",
              "        for (char ch : javaVersionStr.toCharArray()) {",
              "            if (Character.isDigit(ch)) {",
              "                version = (version * 10) + (ch - 48);",
              "            } else if (version == 1) {",
              "                version = 0;",
              "            } else {",
              "                break;",
              "            }",
              "        return version;"
            ],
            "near_context": [
              "/**",
              "* Logback: the reliable, generic, fast and flexible logging framework.",
              "*",
              "* This program and the accompanying materials are dual-licensed under",
              "* either the terms of the Eclipse Public License v1.0 as published by",
              "public class EnvUtil {",
              "",
              "    static private boolean isJDK_N_OrHigher(int n) {",
              "            return false;",
              "        }",
              "    }",
              "",
              "    static public boolean isJDK5() {"
            ]
          },
          {
            "old_start": 52,
            "old_len": 6,
            "new_start": 57,
            "new_len": 10,
            "context": "static public boolean isJDK7OrHigher() {",
            "symbol_guess": "isJDK7OrHigher",
            "removed": [],
            "added": [
              "    static public boolean isJDK9OrHigher() {",
              "        return isJDK_N_OrHigher(9);",
              "    }",
              ""
            ],
            "near_context": [
              "* This program and the accompanying materials are dual-licensed under",
              "* either the terms of the Eclipse Public License v1.0 as published by",
              "public class EnvUtil {",
              "static private boolean isJDK_N_OrHigher(int n) {",
              "return false;",
              "}",
              "}",
              "static public boolean isJDK5() {",
              "        return isJDK_N_OrHigher(7);",
              "    }",
              "",
              "    static public boolean isJaninoAvailable() {",
              "        ClassLoader classLoader = EnvUtil.class.getClassLoader();",
              "        try {"
            ]
          }
        ]
      },
      {
        "path": "logback-core/src/test/java/ch/qos/logback/core/net/HardenedObjectInputStreamTest.java",
        "hunks": [
          {
            "old_start": 1,
            "old_len": 12,
            "new_start": 1,
            "new_len": 17,
            "context": "",
            "symbol_guess": null,
            "removed": [],
            "added": [
              "import static org.junit.Assert.fail;",
              "import java.io.InvalidClassException;",
              "import java.util.HashSet;",
              "import java.util.Set;",
              "import ch.qos.logback.core.util.EnvUtil;"
            ],
            "near_context": [
              "package ch.qos.logback.core.net;",
              "",
              "import static org.junit.Assert.assertEquals;",
              "",
              "import java.io.ByteArrayInputStream;",
              "import java.io.ByteArrayOutputStream;",
              "import java.io.IOException;",
              "import java.io.ObjectOutputStream;",
              "",
              "import org.junit.After;",
              "import org.junit.Before;",
              "import org.junit.Test;"
            ]
          },
          {
            "old_start": 54,
            "old_len": 5,
            "new_start": 59,
            "new_len": 47,
            "context": "private void writeObject(ObjectOutputStream oos, Object o) throws IOException {",
            "symbol_guess": "writeObject",
            "removed": [
              "    "
            ],
            "added": [
              "",
              "    @Test",
              "    public void denialOfService() throws ClassNotFoundException, IOException {",
              "",
              "        if(!EnvUtil.isJDK9OrHigher()) {",
              "            return;",
              "        }",
              "",
              "        ByteArrayInputStream bis = new ByteArrayInputStream(payload());",
              "        inputStream = new HardenedObjectInputStream(bis, whitelist);",
              "        try {",
              "            inputStream.readObject();",
              "            fail(\"InvalidClassException expected\");",
              "        } catch(InvalidClassException e) {",
              "        }",
              "        finally {",
              "            inputStream.close();",
              "        }",
              "    }",
              "",
              "    private byte[] payload() throws IOException {",
              "        Set root = buildEvilHashset();",
              "        writeObject(oos, root);",
              "        return bos.toByteArray();",
              "    }",
              "",
              "    private Set buildEvilHashset() {",
              "        Set root = new HashSet();",
              "        Set s1 = root;",
              "        Set s2 = new HashSet();",
              "        for (int i = 0; i < 100; i++) {",
              "            Set t1 = new HashSet();",
              "            Set t2 = new HashSet();",
              "            t1.add(\"foo\"); // make it not equal to t2",
              "            s1.add(t1);",
              "            s1.add(t2);",
              "            s2.add(t1);",
              "            s2.add(t2);",
              "            s1 = t1;",
              "            s2 = t2;",
              "        }",
              "        return root;",
              "    }"
            ],
            "near_context": [
              "import static org.junit.Assert.assertEquals;",
              "import java.io.ByteArrayInputStream;",
              "import java.io.ByteArrayOutputStream;",
              "import java.io.IOException;",
              "import java.io.ObjectOutputStream;",
              "import org.junit.After;",
              "import org.junit.Before;",
              "import org.junit.Test;",
              "        oos.flush();",
              "        oos.close();",
              "    }",
              "}"
            ]
          }
        ]
      },
      {
        "path": "logback-core/src/test/java/ch/qos/logback/core/rolling/ScaffoldingForRollingTests.java",
        "hunks": [
          {
            "old_start": 24,
            "old_len": 10,
            "new_start": 24,
            "new_len": 10,
            "context": "",
            "symbol_guess": null,
            "removed": [
              "import java.sql.Date;"
            ],
            "added": [
              "import java.util.Date;"
            ],
            "near_context": [
              "",
              "import java.io.File;",
              "import java.io.IOException;",
              "import java.text.SimpleDateFormat;",
              "import java.util.ArrayList;",
              "import java.util.Calendar;",
              "import java.util.Enumeration;",
              "import java.util.List;",
              "import java.util.concurrent.Future;"
            ]
          }
        ]
      },
      {
        "path": "logback-core/src/test/java/ch/qos/logback/core/util/EnvUtilTest.java",
        "hunks": [
          {
            "old_start": 0,
            "old_len": 0,
            "new_start": 1,
            "new_len": 34,
            "context": "",
            "symbol_guess": "Copyright",
            "removed": [],
            "added": [
              "/**",
              " * Logback: the reliable, generic, fast and flexible logging framework.",
              " * Copyright (C) 1999-2023, QOS.ch. All rights reserved.",
              " *",
              " * This program and the accompanying materials are dual-licensed under",
              " * either the terms of the Eclipse Public License v1.0 as published by",
              " * the Eclipse Foundation",
              " *",
              " *   or (per the licensee's choosing)",
              " *",
              " * under the terms of the GNU Lesser General Public License version 2.1",
              " * as published by the Free Software Foundation.",
              " */",
              "package ch.qos.logback.core.util;",
              "",
              "import org.junit.Test;",
              "",
              "import static org.junit.Assert.assertEquals;",
              "",
              "public class EnvUtilTest {",
              "",
              "",
              "    @Test",
              "    public void jdkVersion() {",
              "        assertEquals(4, EnvUtil.getJDKVersion(\"1.4.xx\"));",
              "        assertEquals(5, EnvUtil.getJDKVersion(\"1.5\"));",
              "        assertEquals(5, EnvUtil.getJDKVersion(\"1.5.xx\"));",
              "        assertEquals(5, EnvUtil.getJDKVersion(\"1.5AA\"));",
              "        assertEquals(9, EnvUtil.getJDKVersion(\"9EA\"));",
              "        assertEquals(9, EnvUtil.getJDKVersion(\"9.0.1\"));",
              "        assertEquals(18, EnvUtil.getJDKVersion(\"18.3+xx\"));",
              "        assertEquals(21, EnvUtil.getJDKVersion(\"21.0.1\"));",
              "    }",
              "}"
            ],
            "near_context": [
              "new file mode 100644"
            ]
          }
        ]
      }
    ]
  }
]